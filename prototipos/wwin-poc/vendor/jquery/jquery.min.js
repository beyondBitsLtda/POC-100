/* Minimal jQuery-like helper for offline prototype */
(function (global) {
  function $(selector) {
    if (selector instanceof Wrapper) {
      return selector;
    }
    var elements = [];
    if (typeof selector === 'string') {
      elements = Array.prototype.slice.call(document.querySelectorAll(selector));
    } else if (selector instanceof Element || selector === window || selector === document) {
      elements = [selector];
    } else if (selector instanceof NodeList || Array.isArray(selector)) {
      elements = Array.prototype.slice.call(selector);
    } else if (typeof selector === 'function') {
      if (document.readyState !== 'loading') {
        selector();
      } else {
        document.addEventListener('DOMContentLoaded', selector);
      }
      return new Wrapper([]);
    }
    return new Wrapper(elements);
  }

  function Wrapper(elements) {
    this.elements = elements || [];
  }

  Wrapper.prototype.each = function (callback) {
    this.elements.forEach(function (el, idx) {
      callback.call(el, idx, el);
    });
    return this;
  };

  Wrapper.prototype.on = function (event, handler) {
    return this.each(function () {
      this.addEventListener(event, handler);
    });
  };

  Wrapper.prototype.addClass = function (cls) {
    return this.each(function () {
      this.classList.add(cls);
    });
  };

  Wrapper.prototype.removeClass = function (cls) {
    return this.each(function () {
      this.classList.remove(cls);
    });
  };

  Wrapper.prototype.toggleClass = function (cls, force) {
    return this.each(function () {
      this.classList.toggle(cls, force);
    });
  };

  Wrapper.prototype.attr = function (name, value) {
    if (value === undefined) {
      return this.elements[0] ? this.elements[0].getAttribute(name) : undefined;
    }
    return this.each(function () {
      this.setAttribute(name, value);
    });
  };

  Wrapper.prototype.prop = function (name, value) {
    if (value === undefined) {
      return this.elements[0] ? this.elements[0][name] : undefined;
    }
    return this.each(function () {
      this[name] = value;
    });
  };

  Wrapper.prototype.val = function (value) {
    if (value === undefined) {
      return this.elements[0] ? this.elements[0].value : undefined;
    }
    return this.each(function () {
      this.value = value;
    });
  };

  Wrapper.prototype.find = function (selector) {
    var found = [];
    this.each(function () {
      found = found.concat(Array.prototype.slice.call(this.querySelectorAll(selector)));
    });
    return new Wrapper(found);
  };

  Wrapper.prototype.closest = function (selector) {
    var found = this.elements[0] ? this.elements[0].closest(selector) : null;
    return new Wrapper(found ? [found] : []);
  };

  Wrapper.prototype.data = function (key, value) {
    if (value === undefined) {
      return this.elements[0] ? this.elements[0].dataset[key] : undefined;
    }
    return this.each(function () {
      this.dataset[key] = value;
    });
  };

  Wrapper.prototype.text = function (value) {
    if (value === undefined) {
      return this.elements[0] ? this.elements[0].textContent : undefined;
    }
    return this.each(function () {
      this.textContent = value;
    });
  };

  Wrapper.prototype.html = function (value) {
    if (value === undefined) {
      return this.elements[0] ? this.elements[0].innerHTML : undefined;
    }
    return this.each(function () {
      this.innerHTML = value;
    });
  };

  Wrapper.prototype.first = function () {
    return new Wrapper(this.elements.length ? [this.elements[0]] : []);
  };

  global.$ = $;
})(window);
